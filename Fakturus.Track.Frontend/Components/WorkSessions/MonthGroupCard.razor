<div class="card">
    <!-- Collapsible Header -->
    <div class="flex items-center justify-between cursor-pointer hover:bg-gray-50 p-4 rounded-lg transition-colors"
         @onclick="() => OnToggle.InvokeAsync(MonthGroup)">
        <div class="flex items-center gap-3">
            <!-- Chevron Icon -->
            <span class="text-gray-600 text-xl transition-transform @(MonthGroup.IsExpanded ? "rotate-90" : "")">
                ▶
            </span>
            <!-- Month Info -->
            <div>
                <h3 class="text-lg font-semibold text-gray-900">
                    @MonthGroup.MonthName @MonthGroup.Year
                </h3>
                <p class="text-sm text-gray-600">
                    @MonthGroup.TotalEntries @(MonthGroup.TotalEntries == 1 ? "Eintrag" : "Einträge") - @FormatDuration(MonthGroup.TotalDuration)
                </p>
            </div>
        </div>
    </div>

    <!-- Expanded Content -->
    @if (MonthGroup.IsExpanded)
    {
        <div class="mt-4 space-y-3 px-4 pb-4">
            @foreach (var session in MonthGroup.Sessions)
            {
                <WorkSessionCard WorkSession="session"
                                 OnStart="OnStart"
                                 OnStop="OnStop"
                                 OnFinish="OnFinish"
                                 OnSave="OnSave"
                                 OnDelete="OnDelete"
                                 OnCancel="OnCancel"
                                 OnNew="OnNew"
                                 OnTimeChanged="OnTimeChanged"
                                 IsHistory="true"/>
            }
        </div>
    }
</div>

@code {
    [Parameter] public MonthGroup MonthGroup { get; set; } = null!;

    [Parameter] public EventCallback<MonthGroup> OnToggle { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnStart { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnStop { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnFinish { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnSave { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnDelete { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnCancel { get; set; }

    [Parameter] public EventCallback OnNew { get; set; }

    [Parameter] public EventCallback<WorkSessionModel> OnTimeChanged { get; set; }

    private string FormatDuration(TimeSpan duration)
    {
        var hours = (int)duration.TotalHours;
        var minutes = duration.Minutes;
        return $"{hours:D2}:{minutes:D2}h";
    }

}